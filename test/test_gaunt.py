import unittest
import numpy as np
from dosrixs.utils import gaunt

class TestGaunt(unittest.TestCase):
    def test_gaunt_coefficients(self):
        ref_data = np.array( [ [ -1, -1, -2,  0.000000 ],
                               [ -1, -1, -1,  0.000000 ],
                               [ -1, -1,  0,  0.000000 ],
                               [ -1, -1,  1,  0.000000 ],
                               [ -1, -1,  2,  0.309019 ],
                               [ -1,  0, -2,  0.000000 ],
                               [ -1,  0, -1,  0.000000 ],
                               [ -1,  0,  0,  0.000000 ],
                               [ -1,  0,  1, -0.218510 ],
                               [ -1,  0,  2,  0.000000 ],
                               [ -1,  1, -2,  0.000000 ],
                               [ -1,  1, -1,  0.000000 ],
                               [ -1,  1,  0,  0.126157 ],
                               [ -1,  1,  1,  0.000000 ],
                               [ -1,  1,  2,  0.000000 ],
                               [  0, -1, -2,  0.000000 ],
                               [  0, -1, -1,  0.000000 ],
                               [  0, -1,  0,  0.000000 ],
                               [  0, -1,  1, -0.218510 ],
                               [  0, -1,  2,  0.000000 ],
                               [  0,  0, -2,  0.000000 ],
                               [  0,  0, -1,  0.000000 ],
                               [  0,  0,  0,  0.252313 ],
                               [  0,  0,  1,  0.000000 ],
                               [  0,  0,  2,  0.000000 ],
                               [  0,  1, -2,  0.000000 ],
                               [  0,  1, -1, -0.218510 ],
                               [  0,  1,  0,  0.000000 ],
                               [  0,  1,  1,  0.000000 ],
                               [  0,  1,  2,  0.000000 ],
                               [  1, -1, -2,  0.000000 ],
                               [  1, -1, -1,  0.000000 ],
                               [  1, -1,  0,  0.126157 ],
                               [  1, -1,  1,  0.000000 ],
                               [  1, -1,  2,  0.000000 ],
                               [  1,  0, -2,  0.000000 ],
                               [  1,  0, -1, -0.218510 ],
                               [  1,  0,  0,  0.000000 ],
                               [  1,  0,  1,  0.000000 ],
                               [  1,  0,  2,  0.000000 ],
                               [  1,  1, -2,  0.309019 ],
                               [  1,  1, -1,  0.000000 ],
                               [  1,  1,  0,  0.000000 ],
                               [  1,  1,  1,  0.000000 ],
                               [  1,  1,  2,  0.000000 ]])
        data = np.asarray([ [m1, m2, m3, gaunt(m1=m1, m2=m2, m3=m3)] for m1 in [-1,0,1] for m2 in [-1,0,1] for m3 in [-2,-1,0,1,2]])
        np.testing.assert_allclose(ref_data[:,-1], data[:,-1], rtol=1e-5, atol=1e-5)

if __name__ == "__main__":
    unittest.main(verbosity=2)
